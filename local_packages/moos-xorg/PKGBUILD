pkgname='moos-xorg'
pkgver=20250419
pkgrel=1
pkgdesc='All required packages for a graphical MOOS installation with Xorg.'
arch=('any')
options=('!debug')
depends=(
    # Base packages
    'moos'

    # Display server
    $(pacman -Sgq 'xorg')         # X server and related utilities
    'xorg-xinit'                  # Allow users to manually start the X server
    'xss-lock'                    # Set the active screen locker
    'moos-slock'                  # Screen locker
    'moos-us-keys-xorg'           # Custom US-style keyboard layout for Xorg

    # Window manager
    'moos-dwm'                    # Window manager (runs under the X server).
    'moos-status-bar'             # Status bar for DWM
    
    # Themes
    'breeze-gtk'                  # Breeze theme for GTK
    'qt5-styleplugins'            # Use GTK styles in QT5 applications
    'qt6gtk2'                     # Use GTK styles in QT6 applications

    # Fonts
    'noto-fonts'                  # Google fonts
    'noto-fonts-emoji'            # Google color emojis
    'noto-color-emoji-fontconfig' # Always default to Google's color emojis
    'noto-fonts-cjk'              # Google chinese, japanese, and korean fonts
    'noto-fonts-extra'            # Google extra fonts
    'ttf-hack-nerd'               # Monospace font for coding
    'ttf-liberation'              # Free alternatives to certain MS fonts
    'ttf-ms-win11-auto'           # MS fonts from Win11

    # Applications and Utilities
    'moos-st'                     # Terminal emulator
    'moos-neovim-conf'            # Custom Neovim configuration
    'ffmpeg'                      # AV manipulation + player (ffplay)
    'mpv'                         # AV dedicated player
    'firefox'                     # Normal browser
    'torbrowser-launcher'         # TOR browser
    'libreoffice-still'           # Office Suite
    'moos-snap'                   # Simple screenshot utility

    # Virtual machine
    'qemu-full'                   # Virtual machine (QEMU)
    'libvirt'                     # Wrapper for QEMU
    'virt-manager'                # GUI launcher for QEMU
    'virt-viewer'                 # Advanced VM viewer for QEMU
)
source=(
    '10-secure.conf'
    '20-qol.conf'
    '.bash_profile'
    '.bashrc'
    '.zprofile'
    '.zshrc'
    '.xinitrc'
    '.gtkrc-2.0'
    'gtk3-settings.ini'
    'gtk4-settings.ini'
    'tb-user.js'
    'ff-policies.json'
    'ff_extensions.py'
)
sha256sums=(
    'e5d244ba8652ceda9db4aff11c63b74478367fe681daee53fdf5435c3e5be1bc'
    '106a3154f1942daa9fd9f451baab3fef71ac245b525d8d5d681296ff15ef1e5b'
    '1469da7b27766ad4d07eb202de0142609a72763f5e3088d67893334d68725984'
    '61934632ed4a70fc85dbc4bf22aad3bf3344fa4d23e4ef58c51ec504f288e4c0'
    '1eaf39ce674d65f3d6985ae8d2573f9d87ffc0125676d8a06986c72a7ec25324'
    'ae5968817b518ba0e15dff271195086edc58c0c835d2d3d9a0834fbcc5105adb'
    'a2b934394ce932b50bba5560295725b171cc781834b3a8617b8cade884b39e49'
    '18fc70fc443362ec32257804ceb561a3ae3eaff9a39e01ee79c9f115303c3001'
    'b845d6d8a1b817f323a7e884e9973c4a50fd1aeffd2e88d5b014b599920be956'
    'b845d6d8a1b817f323a7e884e9973c4a50fd1aeffd2e88d5b014b599920be956'
    '2dde5b36a023113cb10bbbd11256dbab36968c459438bcb9ddde5f1d1ac8f8ed'
    'a38a89aceed7e8e328db1d41768bea2b40f6b0044fba5ef51131f49a340fe21e'
    'f3ad9a3a105b8fac962983e590f7632613ea6871f4bcb6c50dafa53df5deea7d'
)

build() {
    python ff_extensions.py "$srcdir/ff-policies.json" "$srcdir/firefox"
}

package() {
    install -Dm644 "10-secure.conf" "$pkgdir/etc/X11/xorg.conf.d/10-secure.conf"
    install -Dm644 "20-qol.conf" "$pkgdir/etc/X11/xorg.conf.d/20-qol.conf"

    _skel="$pkgdir/etc/moos-skel"
    install -Dm644 ".zprofile" "$_skel/.zprofile"
    install -Dm644 ".zshrc" "$_skel/.zshrc"
    install -Dm644 ".xinitrc" "$_skel/.xinitrc"
    install -Dm644 ".gtkrc-2.0" "$_skel/.gtkrc-2.0"
    install -Dm644 "gtk3-settings.ini" "$_skel/.config/gtk-3.0/settings.ini"
    install -Dm644 "gtk4-settings.ini" "$_skel/.config/gtk-4.0/settings.ini"

    _tb="$_skel/.local/share/torbrowser/tbb/x86_64/tor-browser/Browser/TorBrowser/Data/Browser/profile.default"
    install -Dm644 "tb-user.js" "$_tb/user.js"

    rsync --recursive --mkpath "--chmod=D755,F644" "$srcdir/firefox/" "/etc/firefox/"
}
